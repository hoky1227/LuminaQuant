# ==========================================
# LuminaQuant Configuration
# ==========================================

# ------------------------------------------
# System Settings
# ------------------------------------------
system:
  log_level: "INFO"

# ------------------------------------------
# Trading Settings (Live & Backtest)
# ------------------------------------------
trading:
  symbols:
    - "BTC/USDT"
    #- "ETH/USDT"
  timeframe: "1m"
  initial_capital: 10000.0
  target_allocation: 0.1  # 10% of capital per trade
  min_trade_qty: 0.001

# ------------------------------------------
# Risk Settings (Shared)
# ------------------------------------------
risk:
  risk_per_trade: 0.005          # 0.5%
  max_daily_loss_pct: 0.03       # 3%
  max_intraday_drawdown_pct: 0.03
  max_rolling_loss_pct_1h: 0.05
  max_total_margin_pct: 0.50     # 50%
  max_symbol_exposure_pct: 0.25  # 25%
  max_order_value: 5000.0
  default_stop_loss_pct: 0.01
  freeze_new_entries_on_breach: true
  auto_flatten_on_breach: false

# ------------------------------------------
# Execution Model (Shared)
# ------------------------------------------
execution:
  maker_fee_rate: 0.0002
  taker_fee_rate: 0.0004
  spread_rate: 0.0002
  slippage_rate: 0.0005
  funding_rate_per_8h: 0.0
  funding_interval_hours: 8
  maintenance_margin_rate: 0.005
  liquidation_buffer_rate: 0.0005
  compute_backend: "auto" # auto|cpu|gpu|forced-gpu

# ------------------------------------------
# Storage / Audit
# ------------------------------------------
storage:
  backend: "parquet-postgres"
  postgres_dsn: ""
  postgres_dsn_env: "LQ_POSTGRES_DSN"
  market_data_parquet_path: "data/market_parquet"
  market_data_exchange: "binance"
  export_csv: true

# ------------------------------------------
# Backtest Specific Settings
# ------------------------------------------
backtest:
  start_date: "2024-01-01"
  end_date: null  # null means "up to now" or end of data
  commission_rate: 0.001  # 0.1%
  slippage_rate: 0.0005   # 0.05%
  annual_periods: 252     # Daily: 252, 1h: 252*24, 1m: 252*24*60
  random_seed: 42
  persist_output: true
  leverage: 3

# ------------------------------------------
# Live Trading Specific Settings
# ------------------------------------------
live:
  mode: "paper" # paper|real
  exchange:
    driver: "ccxt" # Options: "ccxt", "mt5"
    name: "binance" # Specific exchange name for driver (e.g. "binance" for ccxt)
    market_type: "future" # spot|future
    position_mode: "HEDGE" # ONEWAY|HEDGE
    margin_mode: "isolated" # isolated|cross
    leverage: 3
  testnet: true
  require_real_enable_flag: true
  poll_interval: 2  # Seconds
  heartbeat_interval_sec: 30
  order_timeout: 10 # Seconds
  reconciliation_interval_sec: 30
  # API Keys are best loaded from .env, but can be set here if needed (NOT RECOMMENDED for git)
  # api_key: "YOUR_KEY"
  # secret_key: "YOUR_SECRET"

  # MT5 Specific Settings
  mt5_magic: 234000
  mt5_deviation: 20
  mt5_bridge_python: ""  # WSL: set to Windows python.exe path for bridge mode
  mt5_bridge_script: "scripts/mt5_bridge_worker.py"
  mt5_bridge_use_wslpath: true

# ------------------------------------------
# Optimization (Hyperparameter Tuning)
# ------------------------------------------
optimization:
  method: "OPTUNA" # Options: "GRID", "OPTUNA"
  strategy: "RsiStrategy" # Class name of the strategy to optimize
  walk_forward_folds: 3
  overfit_penalty: 0.5
  max_workers: 4
  persist_best_params: false
  
  # Optuna Settings
  optuna:
    n_trials: 20
    params:
      rsi_period:
        type: "int"
        low: 5
        high: 30
      oversold:
        type: "int"
        low: 20
        high: 40
      overbought:
        type: "int"
        low: 60
        high: 90

  # Grid Search Settings
  grid:
    params:
      rsi_period: [10, 14, 20]
      oversold: [20, 25, 30]
      overbought: [70, 75, 80]

# ------------------------------------------
# Promotion Gate (Soak -> Promote)
# ------------------------------------------
promotion_gate:
  days: 14
  max_order_rejects: 0
  max_order_timeouts: 0
  max_reconciliation_alerts: 0
  max_critical_errors: 0
  require_alpha_card: false
  strategy_profiles:
    RsiStrategy:
      max_order_rejects: 1
      max_order_timeouts: 1
      max_reconciliation_alerts: 0
      max_critical_errors: 0
      require_alpha_card: true
      alpha_card_path: "reports/alpha_card_rsi_strategy.md"
